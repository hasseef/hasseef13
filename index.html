<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ููุตุฉ ุญุตูู ุงููุทููุฉ ููุชูุงูู ุงูุชูููู โ V4 Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root{--royal:#0B3B74;--gold:#D4AF37;--slate:#0f172a;--muted:#475569;--bg:#F6F7F9;--border:#e2e8f0}
:root.dark{--bg:#0b1220;--slate:#e5e7eb;--muted:#94a3b8;--border:#334155}
*{box-sizing:border-box}html{scroll-behavior:smooth}
body{margin:0;font-family:'Tajawal',system-ui,Arial;background:var(--bg);color:var(--slate)}
a{color:var(--royal);text-decoration:none}button{cursor:pointer}
.header{background:var(--royal);color:#fff;border-bottom:4px solid var(--gold)}
.container{max-width:1240px;margin:0 auto;padding:16px}
.flex{display:flex;align-items:center;gap:12px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(max-width:900px){.row{grid-template-columns:1fr}}
.brand{font-weight:900;font-size:18px;display:flex;gap:10px;align-items:center}
.brand img{height:34px}
.nav{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;flex:1}
.nav a{color:#fff;opacity:.92;padding:6px 8px;border-radius:8px}
.nav a.active{opacity:1;background:rgba(255,255,255,.12)}
.badge{display:inline-block;border:1px solid var(--gold);color:var(--royal);border-radius:999px;padding:6px 12px;font-size:12px;background:#fff}
.btn{display:inline-block;background:#1e40af;color:#fff;border:2px solid var(--gold);padding:10px 14px;border-radius:12px;font-weight:700}
.hero{padding:24px 0}
.card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:18px;margin:12px 0}
.grid{display:grid;gap:12px}
.grid-2{grid-template-columns:repeat(2,1fr)}
.grid-3{grid-template-columns:repeat(3,1fr)}
.grid-4{grid-template-columns:repeat(4,1fr)}
@media(max-width:1100px){.grid-4{grid-template-columns:repeat(2,1fr)}}
@media(max-width:640px){.grid-3,.grid-4,.grid-2{grid-template-columns:1fr}}
.tile{background:#fff;border:1px solid var(--border);border-radius:16px;padding:16px;display:flex;gap:12px;align-items:flex-start;transition:.2s}
.tile:hover{border-color:var(--gold);box-shadow:0 6px 16px rgba(0,0,0,.05)}
.icon{width:44px;height:44px;border-radius:50%;border:1px solid var(--gold);display:flex;align-items:center;justify-content:center;background:#fff}
.small{font-size:12px;color:var(--muted)}
.center{text-align:center}
.footer{padding:20px 0;border-top:1px solid var(--border);color:var(--muted);font-size:14px}
.input,select,textarea{width:100%;padding:12px;border:1px solid var(--border);border-radius:12px;background:#fff}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border:1px solid var(--border);padding:10px 12px;font-size:14px;text-align:right;vertical-align:top}
.table th{background:#f8fafc}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
.modal .box{background:#fff;border-radius:16px;border:1px solid var(--border);max-width:900px;width:100%;padding:16px}
.hidden{display:none!important}
.logoRow{display:flex;gap:8px;align-items:center}
.kit{display:none}
.tabs{display:flex;gap:6px;flex-wrap:wrap;margin:8px 0}
.tab{border:1px solid var(--border);border-radius:999px;padding:6px 10px;background:#fff}
.tab.active{border-color:var(--gold)}
.tag{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#1e40af;font-size:12px}
html.dark body{background:var(--bg);color:var(--slate)}
html.dark .header{background:#0a2540}
html.dark .card{background:#0f172a;border-color:var(--border)}
</style>
</head>
<body>
<header class="header">
  <div class="container flex" style="justify-content:space-between">
    <!-- ูููู: ุดุนุงุฑ ุญุตูู -->
    <a class="brand logoRow" href="#home" title="ููุตุฉ ุญุตูู">
      <img src="assets/hasseef.png" alt="Hasseef" onerror="this.style.display='none'">
      <span id="brandTitle">ููุตุฉ ุญุตูู ุงููุทููุฉ ููุชูุงูู ุงูุชูููู</span>
    </a>
    <!-- ุงูููุชุตู: ูุงุฆูุฉ -->
    <nav class="nav" id="topNav">
      <a href="#home" data-i18n="home" class="active">ุงูุฑุฆูุณูุฉ</a>
      <a href="#about" data-i18n="about">ุนู ุงูููุตุฉ</a>
      <a href="#login" data-i18n="accounts">ุงูุญุณุงุจุงุช</a>
      <a href="#register" data-i18n="register">ุชุณุฌูู</a>
      <a href="#map" data-i18n="map">ุงูุฎุฑุงุฆุท</a>
      <a href="#govvalue" data-i18n="govValue">ุงููููุฉ ุงูุญููููุฉ</a>
      <a href="#funding" data-i18n="funding">ุงูุชูููู/ุงูุฑุนุงูุงุช</a>
      <a href="#docs" data-i18n="docs">ุงููุซุงุฆู</a>
      <a href="#subscriptions" data-i18n="subscriptions">ุงูุงุดุชุฑุงูุงุช</a>
      <a href="#sponsors" data-i18n="sponsors">ุงูุฑุนุงุฉ</a>
      <a href="#support" data-i18n="support">ุงูุฏุนู</a>
      <a href="#policies" data-i18n="policies">ุงูุณูุงุณุงุช</a>
      <a href="#contact" data-i18n="contact">ุงุชุตู ุจูุง</a>
      <a href="#admin" data-i18n="admin">ุงูุฅุฏุงุฑุฉ</a>
    </nav>
    <!-- ูุณุงุฑ: ูุถุน ูููู + ูุบุฉ + ุดุนุงุฑุงุช -->
    <div class="flex" style="gap:10px;align-items:center">
      <button class="badge" id="themeBtn" title="ุชุจุฏูู ุงููุถุน">โ๏ธ/๐</button>
      <div class="lang">
        <button class="badge" onclick="setLang('ar')">ุนุฑุจู</button>
        <button class="badge" onclick="setLang('en')">English</button>
      </div>
      <a href="https://www.vision2030.gov.sa/" target="_blank" class="logoRow" title="Vision 2030">
        <img src="assets/vision2030.png" alt="Vision 2030" style="height:28px" onerror="this.style.display='none'">
      </a>
      <a href="https://talbiya.sa" target="_blank" class="logoRow" title="Talbiya R&D">
        <img src="assets/talbiya.png" alt="Talbiya" style="height:28px" onerror="this.style.display='none'">
      </a>
    </div>
  </div>
</header>

<!-- HOME -->
<section id="home" class="kit" style="display:block">
  <div class="hero">
    <div class="container">
      <div class="card">
        <h2>ุฑุงุจุท ูุทูู ูุฑูุฒู ููุชูุงูู ุจูู ุงููุทุงุนุงุช</h2>
        <p class="small">ูุณุฎุฉ ุชุดุบูููุฉ ุชุฌุฑูุจูุฉ ูุญููุฉ (V4 Demo)</p>
        <div class="flex">
          <a class="btn" href="./docs/Hasseef_Official_Report_Main.pdf" target="_blank" data-i18n="download">ุชุญููู ุงููุซููุฉ ุงูุฑุณููุฉ</a>
          <a class="btn" href="#login" data-i18n="login">ุชุณุฌูู ุงูุฏุฎูู</a>
        </div>
      </div>
      <div class="card grid grid-3">
        <div><strong>ุงูุญุณุงุจุงุช</strong><p class="small">ุฃูุฑุงุฏุ ุฎุงุตุ ุบูุฑ ุฑุจุญูุ ุฌุงูุนุงุชุ ุญูููุฉุ ูุงูุญููุ ุดุฑูุงุกุ ููุฆุงุช ุงูุชุทููุฑุ ุฅุฏุงุฑุฉ ุงูููุตุฉ.</p></div>
        <div><strong>ุงูุฎุฏูุงุช</strong><p class="small">ูุดุงุฑูุนุ ูุฑุตุ ูุญุงูุธุ ูุชุญุฏุซููุ ูุฑุงููุ ุชุฏุฑูุจ ุชุนุงูููุ ูุคุดุฑุงุช ูุฎุฑุงุฆุท.</p></div>
        <div><strong>ุงูุญูููุฉ</strong><p class="small">ุฃุฏูุงุฑ ูุตูุงุญูุงุชุ ุณูุฑ ููุงููุงุช ูุชุนุฏุฏ ุงููุฑุงุญูุ ุงุชูุงููุงุช ุฑูููุฉ.</p></div>
      </div>
    </div>
  </div>
</section>

<!-- ABOUT -->
<section id="about" class="kit">
  <div class="container"><div class="card">
    <h3>ุนู ุงูููุตุฉ</h3>
    <p>ุญุตูู ูุนูู ูุฑุงุจุท ูุทูู ูุฑูุฒู ูุฌูุน ุจูู ุฌููุน ุงููุทุงุนุงุช ููู ุฃุฏูุงุฑูุงุ ูุน ุฎุฏูุงุช ููุญูุฏุฉ ูููุญุงุช ููุงุณ ูุฑุชุจุทุฉ ุจุฃูุฏุงู ุฑุคูุฉ 2030.</p>
  </div></div>
</section>

<!-- LOGIN -->
<section id="login" class="kit">
  <div class="container"><div class="card">
    <h3>ุจูุงุจุฉ ุฏุฎูู ุงูุญุณุงุจุงุช</h3>
    <div class="grid grid-4" id="accountTiles"></div>
  </div></div>
</section>

<!-- REGISTER -->
<section id="register" class="kit">
  <div class="container"><div class="card">
    <h3>ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ</h3>
    <div class="row">
      <div><label>ููุน ุงูุญุณุงุจ</label>
        <select class="input" id="regType">
          <option value="individual">ุงูุฃูุฑุงุฏ</option>
          <option value="private">ุงููุทุงุน ุงูุฎุงุต</option>
          <option value="nonprofit">ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู</option>
          <option value="universities">ุงูุฌุงูุนุงุช</option>
          <option value="government">ุงูุญูููุฉ</option>
          <option value="donors">ุงููุงูุญูู</option>
          <option value="partners">ุงูุดุฑูุงุก ุงูุงุณุชุฑุงุชูุฌููู</option>
          <option value="dev_authorities">ููุฆุงุช ุงูุชุทููุฑ</option>
        </select>
      </div>
      <div><label>ุงุณู ุงููุณุชุฎุฏู</label><input class="input" id="regName" placeholder="Admin"></div>
    </div>
    <div class="row">
      <div><label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label><input class="input" id="regEmail" placeholder="name@example.com"></div>
      <div><label>ุงูุฏูุฑ</label><select class="input" id="regRole"><option>Admin</option><option>ูุฏูุฑ</option><option>ูุดุบูู</option><option>ูุฑุงูุจ</option></select></div>
    </div>
    <div class="small" style="margin:8px 0"><input type="checkbox" id="regAgree"> <label for="regAgree">ุฃูุงูู ุนูู <a href="#agreement">ุงูุงุชูุงููุฉ ุงูุฑูููุฉ</a></label></div>
    <div style="text-align:end"><button class="btn" onclick="doRegister()">ุฅูุดุงุก ุงูุญุณุงุจ</button></div>
    <div id="regMsg" class="small hidden" style="margin-top:8px"></div>
  </div></div>
</section>

<!-- MAP -->
<section id="map" class="kit">
  <div class="container"><div class="card">
    <h3>ุงูุฎุฑุงุฆุท ูุงููุคุดุฑุงุช</h3>
    <div class="row">
      <div>
        <label>ุงุฎุชุฑ ุงูููุทูุฉ</label><select class="input" id="regionSel"></select>
        <div class="grid grid-3" style="margin-top:12px">
          <div class="card"><div class="small">ูุธุงุฆู</div><h2 id="kpiJobs">โ</h2></div>
          <div class="card"><div class="small">ููุญ</div><h2 id="kpiGrants">โ</h2></div>
          <div class="card"><div class="small">ูุชุทูุนูู</div><h2 id="kpiVols">โ</h2></div>
        </div>
      </div>
      <div>
        <canvas id="mapChart" height="180"></canvas>
        <p class="small">ุชูุฒูุน ุงููุฑุต ุญุณุจ ููุน ุงูุญุณุงุจ.</p>
      </div>
    </div>
    <div class="card">
      <h4>ุฎุฑูุทุฉ ุงูุณุนูุฏูุฉ (ุชุฌุฑูุจูุฉ)</h4>
      <div id="ksaMap" style="overflow:auto">
        <svg viewBox="0 0 600 320" style="max-width:100%;height:auto;border:1px solid var(--border);border-radius:12px">
          <rect data-region="Riyadh"  x="260" y="120" width="140" height="80" fill="#e5e7eb" stroke="#cbd5e1"/>
          <rect data-region="Hail"    x="200" y=" 80" width="100" height="60" fill="#e5e7eb" stroke="#cbd5e1"/>
          <rect data-region="Makkah"  x="180" y="170" width="120" height="80" fill="#e5e7eb" stroke="#cbd5e1"/>
          <rect data-region="Madinah" x="120" y="120" width="120" height="70" fill="#e5e7eb" stroke="#cbd5e1"/>
          <rect data-region="Eastern" x="420" y="130" width="120" height="120" fill="#e5e7eb" stroke="#cbd5e1"/>
          <text x="290" y="160" font-size="12" fill="#475569">ุงูุฑูุงุถ</text>
          <text x="220" y="110" font-size="12" fill="#475569">ุญุงุฆู</text>
          <text x="200" y="210" font-size="12" fill="#475569">ููุฉ</text>
          <text x="140" y="160" font-size="12" fill="#475569">ุงููุฏููุฉ</text>
          <text x="450" y="190" font-size="12" fill="#475569">ุงูุดุฑููุฉ</text>
        </svg>
      </div>
      <p class="small">ุงููุฑ ููุทูุฉ ูุชุญุฏูุซ ุงููุคุดุฑุงุช.</p>
    </div>
  </div></div>
</section>

<!-- GOV VALUE (ูุฎุชุตุฑ) -->
<section id="govvalue" class="kit">
  <div class="container"><div class="card">
    <h3>ุงููููุฉ ุงููุถุงูุฉ ุงูุญููููุฉ</h3>
    <div class="grid grid-4" id="govValueCards"></div>
    <div class="card center"><a class="btn" href="#govvalue-all">ุนุฑุถ ุงูุชูุงุตูู</a></div>
  </div></div>
</section>

<!-- GOV VALUE TABLE -->
<section id="govvalue-all" class="kit">
  <div class="container"><div class="card">
    <h3>ุชูุงุตูู ุงููููุฉ ุงููุถุงูุฉ</h3>
    <div class="row"><div><input class="input" id="q" placeholder="ุงุจุญุซ ุนู ุฌูุฉ..."></div><div style="display:flex;align-items:end"><button class="btn" onclick="filterGovTable()">ุจุญุซ</button></div></div>
    <div style="overflow:auto;margin-top:8px">
      <table class="table" id="tblGV"><thead><tr><th>ุงูุฌูุฉ</th><th>ุงูุนููุงู ุงููุฎุชุตุฑ</th><th>ุงููุตู</th></tr></thead><tbody></tbody></table>
    </div>
  </div></div>
</section>

<!-- DASHBOARD (ููุญุฉ ุงูุญุณุงุจ) -->
<section id="dashboard" class="kit">
  <div class="container">
    <div class="card"><h3 id="dashTitle">ููุญุฉ ุงูุญุณุงุจ</h3><p class="small" id="dashDesc"></p></div>

    <div class="tabs" id="dashTabs"></div>

    <div id="dashContent">
      <!-- ุชุจููุจ Projects -->
      <div class="card" data-tab="Projects">
        <h4>ุงููุดุงุฑูุน/ุงููุจุงุฏุฑุงุช</h4>
        <div class="row">
          <div><label>ุงูุนููุงู</label><input class="input" id="p_title"></div>
          <div><label>ุงููุทุงุน ุงููุณุชูุฏู</label><select class="input" id="p_sector"><option>ุชุนูููู</option><option>ุตุญู</option><option>ุงุฌุชูุงุนู</option><option>ุซูุงูู</option></select></div>
        </div>
        <div class="row">
          <div><label>ุงูููุฒุงููุฉ (SAR)</label><input class="input" id="p_budget" type="number" min="0" step="1000"></div>
          <div><label>ุงูุญุงูุฉ</label><select class="input" id="p_status"><option>ุฌุฏูุฏ</option><option>ููุฏ ุงูุชูููุฐ</option><option>ููุชูู</option></select></div>
        </div>
        <div><label>ูุตู ูุฎุชุตุฑ</label><textarea class="input" id="p_desc" rows="3"></textarea></div>
        <div style="text-align:end"><button class="btn" onclick="dbAdd('projects')">ุฅุถุงูุฉ</button></div>
        <div class="card"><table class="table" id="tblProjects"><thead><tr><th>ุงูุนููุงู</th><th>ุงููุทุงุน</th><th>ุงูููุฒุงููุฉ</th><th>ุงูุญุงูุฉ</th><th></th></tr></thead><tbody></tbody></table></div>
      </div>

      <!-- ุชุจููุจ Opportunities -->
      <div class="card hidden" data-tab="Opportunities">
        <h4>ุงููุฑุต (ูุธุงุฆู/ุชุทูุน/ููุญ/ูุนุงููุงุช)</h4>
        <div class="row">
          <div><label>ุงูููุน</label><select class="input" id="o_type"><option>ูุธููุฉ</option><option>ุชุทูุน</option><option>ููุญุฉ</option><option>ูุนุงููุฉ</option></select></div>
          <div><label>ุงูุนููุงู</label><input class="input" id="o_title"></div>
        </div>
        <div class="row">
          <div><label>ุงูุฌูุฉ</label><input class="input" id="o_org"></div>
          <div><label>ุงููููุน</label><input class="input" id="o_loc"></div>
        </div>
        <div style="text-align:end"><button class="btn" onclick="dbAdd('opps')">ุฅุถุงูุฉ</button></div>
        <div class="card"><table class="table" id="tblOpps"><thead><tr><th>ุงูููุน</th><th>ุงูุนููุงู</th><th>ุงูุฌูุฉ</th><th>ุงููููุน</th><th></th></tr></thead><tbody></tbody></table></div>
      </div>

      <!-- ุชุจููุจ Wallet -->
      <div class="card hidden" data-tab="Wallet">
        <h4>ุงููุญูุธุฉ ุงููุงููุฉ</h4>
        <div class="row">
          <div><label>ููุน ุงูุนูููุฉ</label><select class="input" id="w_type"><option>ุชุจุฑุน</option><option>ุงุณุชุซูุงุฑ</option><option>ุงุดุชุฑุงู</option><option>ุฑุนุงูุฉ</option></select></div>
          <div><label>ุงููุจูุบ (SAR)</label><input class="input" id="w_amount" type="number" min="0" step="100"></div>
        </div>
        <div style="text-align:end"><button class="btn" onclick="dbAdd('wallet')">ุฅุถุงูุฉ</button></div>
        <div class="card"><table class="table" id="tblWallet"><thead><tr><th>ุงูููุน</th><th>ุงููุจูุบ</th><th>ุงูุชุงุฑูุฎ</th><th></th></tr></thead><tbody></tbody></table></div>
      </div>

      <!-- ุชุจููุจ Speakers -->
      <div class="card hidden" data-tab="Speakers">
        <h4>ูุฑูุฒ ุงููุชุญุฏุซูู</h4>
        <div class="row">
          <div><label>ุงูุงุณู</label><input class="input" id="s_name"></div>
          <div><label>ุงูุชุฎุตุต</label><input class="input" id="s_field"></div>
        </div>
        <div class="row">
          <div><label>ุงูุฌูุฉ</label><input class="input" id="s_org"></div>
          <div><label>ุงูุญุงูุฉ</label><select class="input" id="s_status"><option>ูุฑุดุญ</option><option>ูุนุชูุฏ</option></select></div>
        </div>
        <div style="text-align:end"><button class="btn" onclick="dbAdd('speakers')">ุฅุถุงูุฉ</button></div>
        <div class="card"><table class="table" id="tblSpeakers"><thead><tr><th>ุงูุงุณู</th><th>ุงูุชุฎุตุต</th><th>ุงูุฌูุฉ</th><th>ุงูุญุงูุฉ</th><th></th></tr></thead><tbody></tbody></table></div>
      </div>

      <!-- ุชุจููุจ Facilities -->
      <div class="card hidden" data-tab="Facilities">
        <h4>ุฅุฏุงุฑุฉ ุงููุฑุงูู</h4>
        <div class="row">
          <div><label>ุงูููุดุฃุฉ</label><input class="input" id="f_name"></div>
          <div><label>ุงูููุน</label><select class="input" id="f_type"><option>ูุงุนุฉ</option><option>ูุนูู</option><option>ูุณุฑุญ</option><option>ูุฑูู ุฑูุงุถู</option></select></div>
        </div>
        <div class="row">
          <div><label>ุงูุณุนุฉ</label><input class="input" id="f_cap" type="number" min="0"></div>
          <div><label>ุงููููุน</label><input class="input" id="f_loc"></div>
        </div>
        <div style="text-align:end"><button class="btn" onclick="dbAdd('facilities')">ุฅุถุงูุฉ</button></div>
        <div class="card"><table class="table" id="tblFacilities"><thead><tr><th>ุงูููุดุฃุฉ</th><th>ุงูููุน</th><th>ุงูุณุนุฉ</th><th>ุงููููุน</th><th></th></tr></thead><tbody></tbody></table></div>
      </div>

      <!-- ุชุจููุจ Co-op -->
      <div class="card hidden" data-tab="Coop">
        <h4>ุงูุชุฏุฑูุจ ุงูุชุนุงููู</h4>
        <div class="row">
          <div><label>ุงูุฌูุฉ</label><input class="input" id="c_org"></div>
          <div><label>ุงููุณูู</label><input class="input" id="c_title"></div>
        </div>
        <div class="row">
          <div><label>ุงููุฏุฉ (ุฃุดูุฑ)</label><input class="input" id="c_months" type="number" min="1" max="12"></div>
          <div><label>ุงูุญุงูุฉ</label><select class="input" id="c_status"><option>ูุชุงุญ</option><option>ูุบูู</option></select></div>
        </div>
        <div style="text-align:end"><button class="btn" onclick="dbAdd('coop')">ุฅุถุงูุฉ</button></div>
        <div class="card"><table class="table" id="tblCoop"><thead><tr><th>ุงูุฌูุฉ</th><th>ุงููุณูู</th><th>ุงููุฏุฉ</th><th>ุงูุญุงูุฉ</th><th></th></tr></thead><tbody></tbody></table></div>
      </div>

    </div>
  </div>
</section>

<!-- FUNDING -->
<section id="funding" class="kit">
  <div class="container"><div class="card">
    <h3>ุณูุฑ ููุงููุงุช ุงูุชูููู/ุงูุฑุนุงูุงุช</h3>
    <p class="small">ูุฑุงุญู: ุทูุจ โ ุชุฏููู โ ุงุนุชูุงุฏ ุฃููู โ ุงุนุชูุงุฏ ููุงุฆู. (ูุญุงูุงุฉ ูุญููุฉ)</p>
    <div class="row">
      <div><label>ุนููุงู ุงูุทูุจ</label><input class="input" id="wf_title" placeholder="ูุซุงู: ุฑุนุงูุฉ ูุนุงููุฉ ูุฌุชูุนูุฉ"></div>
      <div><label>ุงููููุฉ (SAR)</label><input class="input" id="wf_amount" type="number" min="0" step="1000"></div>
    </div>
    <div class="row">
      <div><label>ุงูุญุณุงุจ</label><select class="input" id="wf_account"><option>ุบูุฑ ุฑุจุญู</option><option>ุฎุงุต</option><option>ุฌุงูุนุงุช</option><option>ุญูููุฉ</option><option>ููุฆุงุช ุงูุชุทููุฑ</option></select></div>
      <div style="display:flex;align-items:end"><button class="btn" onclick="wfCreate()">ุฅุฑุณุงู</button></div>
    </div>
    <hr>
    <table class="table" id="wfTbl"><thead><tr><th>ุงูุนููุงู</th><th>ุงููููุฉ</th><th>ุงูุญุณุงุจ</th><th>ุงููุฑุญูุฉ</th><th>ุฅุฌุฑุงุกุงุช</th></tr></thead><tbody></tbody></table>
  </div></div>
</section>

<!-- DOCS -->
<section id="docs" class="kit">
  <div class="container"><div class="card">
    <h3>ุงููุซุงุฆู ุงูุฑุณููุฉ</h3>
    <div id="docsList" class="grid grid-3"></div>
    <div class="center" style="margin-top:10px"><a class="btn" href="./docs/Hasseef_Official_Report_Main.pdf" target="_blank">ุชุญููู ุงููุซููุฉ ุงูุฑุณููุฉ</a></div>
  </div></div>
</section>

<!-- SUBSCRIPTIONS -->
<section id="subscriptions" class="kit"><div class="container grid grid-3">
  <div class="card"><h4>ุฃุณุงุณู</h4><ul class="small"><li>ุฅุฏุงุฑุฉ ูุดุงุฑูุน ุญุชู 25</li><li>ูุญูุธุฉ ุฃุณุงุณูุฉ</li><li>Webhook ูุงุญุฏ</li></ul><div class="center"><button class="btn">ุงุจุฏุฃ</button></div></div>
  <div class="card"><h4>ูุชูุฏู</h4><ul class="small"><li>ูุดุงุฑูุน ุบูุฑ ูุญุฏูุฏุฉ</li><li>ุชูุงุฑูุฑ ูุงููุฉ</li><li>ููุงุชูุญ API ูุชุนุฏุฏุฉ</li></ul><div class="center"><button class="btn">ุงุฎุชุฑ</button></div></div>
  <div class="card"><h4>ูุชููุฒ</h4><ul class="small"><li>ุญูููุฉ ูุตูุงุญูุงุช</li><li>SLA</li><li>ุงุณุชุถุงูุฉ ุฎุงุตุฉ</li></ul><div class="center"><button class="btn">ุชูุงุตู</button></div></div>
</div></section>

<!-- SPONSORS -->
<section id="sponsors" class="kit"><div class="container grid grid-3">
  <div class="card"><h4>ุงุณุชุฑุงุชูุฌู</h4><ul class="small"><li>ูููุฉ ูุดุชุฑูุฉ</li><li>ุชูุฑูุฑ ูุทูู</li><li>ูุณุงุญุงุช ุฑุฆูุณูุฉ</li></ul></div>
  <div class="card"><h4>ุจูุงุชููู</h4><ul class="small"><li>ุดุนุงุฑ ุฑุฆูุณู</li><li>ุชูุงุฑูุฑ ุฑุจุน ุณูููุฉ</li><li>ุฏุนูุงุช</li></ul></div>
  <div class="card"><h4>ุฐูุจู</h4><ul class="small"><li>ุดุนุงุฑ ุฏุงุฎูู</li><li>ุชูุงุฑูุฑ ูุตู ุณูููุฉ</li><li>ูุญุชูู ุชุนุฑููู</li></ul></div>
</div></section>

<!-- SUPPORT -->
<section id="support" class="kit"><div class="container">
  <div class="card">
    <h3>ุงูุฏุนู ุงูููู</h3>
    <div class="row">
      <div><label>ุงูููุถูุน</label><input class="input" id="s1" placeholder="ูุซุงู: ูุดููุฉ ุชุณุฌูู ุงูุฏุฎูู"></div>
      <div><label>ุงูุฃููููุฉ</label><select class="input" id="s2"><option>ุนุงุฏูุฉ</option><option>ุนุงุฌูุฉ</option><option>ุทุงุฑุฆุฉ</option></select></div>
    </div>
    <div><label>ุงูุชูุงุตูู</label><textarea class="input" id="s3" rows="4"></textarea></div>
    <div style="text-align:end"><button class="btn" onclick="addTicket()">ุฅุฑุณุงู</button></div>
  </div>
  <div class="card">
    <h4>ุชุฐุงูุฑ ุณุงุจูุฉ</h4>
    <table class="table" id="tickets"><thead><tr><th>ุงูููุถูุน</th><th>ุงูุฃููููุฉ</th><th>ุงูุญุงูุฉ</th></tr></thead><tbody></tbody></table>
  </div>
</div></section>

<!-- POLICIES -->
<section id="policies" class="kit"><div class="container"><div class="card">
  <h3>ุงูุณูุงุณุงุช ูุงูุดุฑูุท</h3>
  <p class="small">ููุชุฒู ุจุญูุงูุฉ ุงูุจูุงูุงุช ููู ุงูุฃูุธูุฉ ุงูุณุนูุฏูุฉ ููุนุงููุฑ ุงูุฃูู ุงููุทูู.</p>
</div></div></section>

<!-- CONTACT -->
<section id="contact" class="kit"><div class="container">
  <div class="card">
    <h3>ุงุชุตู ุจูุง</h3>
    <div class="row">
      <div><label>ุงูุงุณู</label><input class="input" placeholder="ุงูุงุณู ุงููุงูู"></div>
      <div><label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label><input class="input" placeholder="name@example.com"></div>
    </div>
    <div class="row">
      <div><label>ุงููุงุชู</label><input class="input" placeholder="+966 55 608 3172"></div>
      <div><label>ููุน ุงูุฑุณุงูุฉ</label><select class="input"><option>ุงุณุชูุณุงุฑ</option><option>ููุชุฑุญ</option><option>ุจูุงุบ ุชููู</option><option>ุฑุนุงูุฉ/ุดุฑุงูุฉ</option></select></div>
    </div>
    <div><label>ุงูุฑุณุงูุฉ</label><textarea class="input" rows="4"></textarea></div>
    <div id="sent" class="card small hidden">ุชู ุงูุฅุฑุณุงู โ ุดูุฑูุง ูุชูุงุตูู.</div>
    <div style="text-align:end"><button class="btn" onclick="document.getElementById('sent').classList.remove('hidden')">ุฅุฑุณุงู</button></div>
  </div>
  <div class="card"><h4>ุจูุงูุงุช ุงูุชูุงุตู ุงูุฑุณููุฉ</h4><p class="small">ุงููุงุชู: +966 55 608 3172 โ ุงูุจุฑูุฏ: info@talbiya.sa โ ุงููููุน: https://talbiya.sa</p></div>
</div></section>

<!-- AGREEMENT -->
<section id="agreement" class="kit"><div class="container"><div class="card">
  <h3>ุงูุงุชูุงููุฉ ุงูุฑูููุฉ</h3>
  <ul class="small"><li>ุงูุงุณุชุฎุฏุงู ุงููุณุคูู ููุฎุฏูุงุช.</li><li>ุญูุงูุฉ ุงูุจูุงูุงุช.</li><li>ุงูุงูุชุฒุงู ุจุฃูุฏุงู ุฑุคูุฉ 2030.</li></ul>
  <div class="center"><a class="btn" href="#login">ุนูุฏุฉ</a></div>
</div></div></section>

<footer class="footer">
  <div class="container flex" style="justify-content:space-between">
    <div>ยฉ 2025 ููุตุฉ ุญุตูู โ ุดุฑูุฉ ุชูุจูุฉ ููุจุญุซ ูุงูุชุทููุฑ</div>
    <div class="logoRow">
      <a href="https://www.vision2030.gov.sa/" target="_blank"><img src="assets/vision2030.png" alt="vision" style="height:26px" onerror="this.style.display='none'"></a>
      <a href="https://talbiya.sa" target="_blank"><img src="assets/talbiya.png" alt="talbiya" style="height:26px" onerror="this.style.display='none'"></a>
    </div>
  </div>
</footer>

<!-- AGREEMENT POPUP -->
<div class="modal" id="agreementModal">
  <div class="box">
    <h4>ุงูุงุชูุงููุฉ ุงูุฑูููุฉ</h4>
    <p class="small">ูุฌุจ ุงูููุงููุฉ ูุจู ุฅูุดุงุก ุงูุญุณุงุจ ุฃู ุงูุฏุฎูู.</p>
    <div class="card" style="max-height:220px;overflow:auto"><p>ุจููุฏ ูุฎุชุตุฑุฉ: ุงุณุชุฎุฏุงู ูุณุคููุ ุดูุงููุฉุ ุญูุงูุฉ ุงูุจูุงูุงุช.</p></div>
    <div class="flex" style="justify-content:flex-end">
      <button id="agreeCancel" class="badge">ุฅูุบุงุก</button>
      <button id="agreeAccept" class="btn">ููุงููุฉ ููุชุงุจุนุฉ</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
/* i18n */
const i18n={ar:{home:"ุงูุฑุฆูุณูุฉ",about:"ุนู ุงูููุตุฉ",accounts:"ุงูุญุณุงุจุงุช",govValue:"ุงููููุฉ ุงูุญููููุฉ",subscriptions:"ุงูุงุดุชุฑุงูุงุช",sponsors:"ุงูุฑุนุงุฉ",support:"ุงูุฏุนู",policies:"ุงูุณูุงุณุงุช",contact:"ุงุชุตู ุจูุง",download:"ุชุญููู ุงููุซููุฉ ุงูุฑุณููุฉ",login:"ุชุณุฌูู ุงูุฏุฎูู",map:"ุงูุฎุฑุงุฆุท",docs:"ุงููุซุงุฆู",funding:"ุงูุชูููู/ุงูุฑุนุงูุงุช",admin:"ุงูุฅุฏุงุฑุฉ",register:"ุชุณุฌูู"},en:{home:"Home",about:"About",accounts:"Accounts",govValue:"Gov Added Value",subscriptions:"Subscriptions",sponsors:"Sponsors",support:"Support",policies:"Policies",contact:"Contact",download:"Download Official Document",login:"Sign In",map:"Maps",docs:"Documents",funding:"Funding/Sponsorship",admin:"Admin",register:"Register"}};
function currentLang(){return localStorage.getItem('lang')||'ar'}
function setLang(lang){localStorage.setItem('lang',lang);document.documentElement.lang=(lang==='ar'?'ar':'en');document.documentElement.dir=(lang==='ar'?'rtl':'ltr');document.querySelectorAll("[data-i18n]").forEach(el=>{const k=el.getAttribute('data-i18n');el.textContent=i18n[lang][k]||el.textContent;});}
document.addEventListener('DOMContentLoaded',()=>{setLang(currentLang());});

/* Theme */
(function(){const root=document.documentElement;const saved=localStorage.getItem('theme')||'light';if(saved==='dark'){root.classList.add('dark');}document.getElementById('themeBtn')?.addEventListener('click',()=>{root.classList.toggle('dark');localStorage.setItem('theme',root.classList.contains('dark')?'dark':'light');});})();

/* Router */
const sections=[...document.querySelectorAll('.kit')];
function route(){
  const id=(location.hash||'#home').replace('#','');sections.forEach(s=>s.style.display=s.id===id?'block':'none');
  document.querySelectorAll('#topNav a').forEach(a=>a.classList.toggle('active',a.getAttribute('href')==='#'+id));
  if(id==='home'){renderGovCards();}
  if(id==='govvalue-all'){renderGovTable();}
  if(id==='login'){renderAccounts();}
  if(id==='dashboard'){renderDashboard();initDashTabs();}
  if(id==='admin'){renderUsers();}
  if(id==='map'){renderMap();bindSvgMap();}
  if(id==='docs'){renderDocs();}
  if(id==='funding'){wfRender();}
}
window.addEventListener('hashchange',route);route();

/* ุฃููููุงุช ุฃุญุงุฏูุฉ ุงูููู */
const ico={person:'๐ค',bldg:'๐ข',gov:'๐๏ธ',uni:'๐',heart:'๐',handshake:'๐ค',cog:'โ๏ธ',map:'๐บ๏ธ'};

/* GOV VALUE */
window.govValues=[
 {id:'mep',name:'ูุฒุงุฑุฉ ุงูุงูุชุตุงุฏ ูุงูุชุฎุทูุท',brief:'ููุงุกูุฉ ุงูุฃุฏุงุก ุงููุทูู',detail:'ุฑุจุท ุงููุจุงุฏุฑุงุช ุจูุคุดุฑุงุช ุงูุฑุคูุฉ ูุชุญููู ุงููุฌูุงุช ูุฅุตุฏุงุฑ ุชูุงุฑูุฑ ููุญุฏุฉ.'},
 {id:'mof',name:'ูุฒุงุฑุฉ ุงููุงููุฉ',brief:'ููุงุกุฉ ุงูุฅููุงู',detail:'ุชุชุจุน ุงูุชูููู ุงูุชูููู ูุชุญุณูู ุงูุนุงุฆุฏ ุนุจุฑ ูุญูุธุฉ ุงูููุญ ูุงูุงุณุชุซูุงุฑ ูุงูุงุดุชุฑุงู ูุงูุฑุนุงูุฉ.'},
 {id:'moi',name:'ูุฒุงุฑุฉ ุงูุฏุงุฎููุฉ (ุฅูุงุฑุงุช ุงูููุงุทู)',brief:'ุชูุงูู ุงูููุงุทู',detail:'ุชูุงุฑูุฑ ููุงููุฉ ููุญุฏุฉ ููููุงุทู ูุฅุฏุงุฑุฉ ุงููุดุงุฑูุน ูุงูููุงููุงุช.'},
 {id:'dev',name:'ููุฆุงุช ุชุทููุฑ ุงูููุงุทู',brief:'ุชูููู ุงูุชุทููุฑ',detail:'ูุชุงุจุนุฉ ูุจุงุฏุฑุงุช ุงูุชูููุฉ ูุฑุจุทูุง ุจุงูุฃุซุฑ ูุชูุณูู ุงูุดุฑุงูุงุช.'},
 {id:'moe',name:'ูุฒุงุฑุฉ ุงูุชุนููู',brief:'ุงูุชุนุฒูุฒ ุงูุนููู',detail:'ุฅุดุฑุงู ุงูุฌุงูุนุงุช ููุฑุงูุฒ ุงุณุชุดุงุฑูุฉ ูุฅุชุงุญุฉ ุงูุชุฏุฑูุจ ุงูุชุนุงููู.'},
 {id:'adaa',name:'ูุฑูุฒ ุฃุฏุงุก',brief:'ููุงุณ ุงูุฃุซุฑ',detail:'ุชูุญูุฏ ุฃุฏูุงุช ุงูููุงุณ ูุฑุจุทูุง ุจููุญุงุช ุงูููุตุฉ.'},
 {id:'ncdc',name:'ุงููุฑูุฒ ุงููุทูู ูุชูููุฉ ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู',brief:'ุชูููู ุงูููุธูุงุช',detail:'ุฑูุน ููุงุกุฉ ุงูููุธูุงุช ูุฑุจุทูุง ุจุงููููููู ูุงูุดุฑูุงุก.'},
 {id:'monshaat',name:'ููุดุขุช',brief:'ุฏุนู ุงูููุดุขุช ุงูุตุบูุฑุฉ',detail:'ุชุญููุฒ ุงูุดุฑูุงุช ุงูุตุบูุฑุฉ ุนุจุฑ ุงูุฑุนุงูุฉ ูุงูุงุณุชุซูุงุฑ.'}
];
function renderGovCards(){document.getElementById('govValueCards').innerHTML=govValues.map(v=>`<div class="tile"><div class="icon">${ico.bldg}</div><div><h4>${v.name}</h4><p class="small">${v.brief}</p><p><button class="badge" onclick="showValue('${v.id}')">ุนุฑุถ ุงูุชูุงุตูู</button></p></div></div>`).join('');}
function showValue(id){const m=document.getElementById('agreementModal');m.querySelector('h4').textContent=govValues.find(x=>x.id===id).name;m.querySelector('.card p').textContent=govValues.find(x=>x.id===id).detail;m.style.display='flex';document.getElementById('agreeCancel').onclick=()=>m.style.display='none';document.getElementById('agreeAccept').onclick=()=>m.style.display='none';}
function renderGovTable(){const tb=document.querySelector('#tblGV tbody');tb.innerHTML='';(govValues||[]).forEach(v=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${v.name}</td><td>${v.brief}</td><td>${v.detail}</td>`;tb.appendChild(tr);});}
function filterGovTable(){const q=document.getElementById('q').value.trim().toLowerCase();document.querySelectorAll('#tblGV tbody tr').forEach(r=>r.style.display=r.textContent.toLowerCase().includes(q)?'':'none');}

/* Accounts */
const accounts=[
 {key:'individual',name:'ุงูุฃูุฑุงุฏ',desc:'ููู ูุจุงุฏุฑุงุช ููุฑุต ููุญูุธุฉ',icon:ico.person,tabs:['Projects','Opportunities','Wallet']},
 {key:'private',name:'ุงููุทุงุน ุงูุฎุงุต',desc:'CSR ูุฑุนุงูุงุช ูุชูุงุฑูุฑ ุฃุซุฑ',icon:ico.bldg,tabs:['Projects','Opportunities','Wallet']},
 {key:'nonprofit',name:'ุงููุทุงุน ุบูุฑ ุงูุฑุจุญู',desc:'ูุดุงุฑูุน ููุชุทูุนูู ูุฃุซุฑ',icon:ico.gov,tabs:['Projects','Opportunities','Wallet']},
 {key:'universities',name:'ุงูุฌุงูุนุงุช',desc:'ุชุนุฒูุฒ ุนููู ูุชุฏุฑูุจ ุชุนุงููู',icon:ico.uni,tabs:['Projects','Opportunities','Facilities','Speakers','Coop']},
 {key:'government',name:'ุงูุญูููุฉ',desc:'ุญููู ููุนุงููุงุช ููุคุดุฑุงุช',icon:ico.gov,tabs:['Projects','Speakers','Facilities','Coop']},
 {key:'donors',name:'ุงููุงูุญูู',desc:'ูุญูุธุฉ ูุชูุงุฑูุฑ ุฃุซุฑ',icon:ico.heart,tabs:['Wallet','Opportunities']},
 {key:'partners',name:'ุงูุดุฑูุงุก ุงูุงุณุชุฑุงุชูุฌููู',desc:'ููุญุงุช ูุทููุฉ ูุชุจุงุฏู ุจูุงูุงุช',icon:ico.handshake,tabs:['Projects','Opportunities']},
 {key:'dev_authorities',name:'ููุฆุงุช ุงูุชุทููุฑ',desc:'ูุดุงุฑูุน ุงูููุงุทู ูุงูุดุฑุงูุงุช',icon:ico.map,tabs:['Projects','Facilities','Speakers']},
 {key:'admin',name:'ุฅุฏุงุฑุฉ ุงูููุตุฉ (Admin)',desc:'ุญูููุฉ ูุตูุงุญูุงุช ูุชูุงูู',icon:ico.cog,tabs:[]} // ููุชูู ููุณู ุงูุฅุฏุงุฑุฉ
];
function renderAccounts(){document.getElementById('accountTiles').innerHTML=accounts.map(a=>`<div class="tile"><div class="icon">${a.icon}</div><div><h4>${a.name}</h4><p class="small">${a.desc}</p><p><button class="badge" onclick="loginAs('${a.key}')">ุฏุฎูู</button></p></div></div>`).join('');}
function openAgreement(onAccept){const modal=document.getElementById('agreementModal');modal.style.display='flex';document.getElementById('agreeAccept').onclick=()=>{modal.style.display='none';onAccept&&onAccept();};document.getElementById('agreeCancel').onclick=()=>{modal.style.display='none';};}
function loginAs(account){openAgreement(()=>{localStorage.setItem('account',account);location.hash=(account==='admin')?'admin':'dashboard';});}

/* โูุงุนุฏุฉ ุจูุงูุงุชโ ูุญููุฉ */
const DB_KEY='hasseef_db_v4';
const db = {
  load(){try{return JSON.parse(localStorage.getItem(DB_KEY))||{projects:[],opps:[],wallet:[],speakers:[],facilities:[],coop:[],wf:[],users:[],roles:{Admin:'ูุฑุงุกุฉ, ุฅูุดุงุก, ุชุนุฏูู, ุงุนุชูุงุฏ, ุชูุงูู',Manager:'ูุฑุงุกุฉ, ุฅูุดุงุก, ุชุนุฏูู, ุงุนุชูุงุฏ',Operator:'ูุฑุงุกุฉ, ุชูููุฐ',Observer:'ูุฑุงุกุฉ'}}}catch(e){return {projects:[],opps:[],wallet:[],speakers:[],facilities:[],coop:[],wf:[],users:[],roles:{}}}},
  save(data){localStorage.setItem(DB_KEY,JSON.stringify(data))}
};
let state=db.load();

/* Dashboard */
function renderDashboard(){
  const acc=localStorage.getItem('account')||'individual';
  const meta=accounts.find(a=>a.key===acc)||accounts[0];
  document.getElementById('dashTitle').textContent='ููุญุฉ ุญุณุงุจ: '+meta.name;
  document.getElementById('dashDesc').textContent=meta.desc;
  // ุชููุฆุฉ ุงูุชุจููุจุงุช ุญุณุจ ุงูุญุณุงุจ
  const tabs=document.getElementById('dashTabs'); tabs.innerHTML='';
  (meta.tabs||[]).forEach((t,i)=>{tabs.insertAdjacentHTML('beforeend',`<button class="tab ${i===0?'active':''}" data-t="${t}" onclick="switchTab('${t}')">${t}</button>`);});
  // ุฅุธูุงุฑ ุฃูู ุชุจููุจ
  document.querySelectorAll('#dashContent>[data-tab]').forEach(x=>x.classList.add('hidden'));
  if(meta.tabs?.[0]) document.querySelector(`#dashContent [data-tab="${meta.tabs[0]}"]`)?.classList.remove('hidden');
  // ููุก ุงูุฌุฏุงูู
  fillTables();
}
function initDashTabs(){
  const acc=localStorage.getItem('account')||'individual';
  const meta=accounts.find(a=>a.key===acc)||accounts[0];
  (meta.tabs||[]).forEach((t,i)=>{if(i===0)switchTab(t);});
}
function switchTab(t){
  document.querySelectorAll('#dashContent>[data-tab]').forEach(x=>x.classList.toggle('hidden',x.getAttribute('data-tab')!==t));
  document.querySelectorAll('#dashTabs .tab').forEach(x=>x.classList.toggle('active',x.getAttribute('data-t')===t));
}
function fillTables(){
  // Projects
  const tbP=document.querySelector('#tblProjects tbody'); if(tbP){tbP.innerHTML='';state.projects.forEach((r,i)=>tbP.insertAdjacentHTML('beforeend',`<tr><td>${r.title}</td><td>${r.sector}</td><td>${(+r.budget).toLocaleString('en')}</td><td>${r.status}</td><td><button class="badge" onclick="delRow('projects',${i})">ุญุฐู</button></td></tr>`));}
  // Opps
  const tbO=document.querySelector('#tblOpps tbody'); if(tbO){tbO.innerHTML='';state.opps.forEach((r,i)=>tbO.insertAdjacentHTML('beforeend',`<tr><td><span class="tag">${r.type}</span></td><td>${r.title}</td><td>${r.org}</td><td>${r.loc}</td><td><button class="badge" onclick="delRow('opps',${i})">ุญุฐู</button></td></tr>`));}
  // Wallet
  const tbW=document.querySelector('#tblWallet tbody'); if(tbW){tbW.innerHTML='';state.wallet.forEach((r,i)=>tbW.insertAdjacentHTML('beforeend',`<tr><td>${r.type}</td><td>${(+r.amount).toLocaleString('en')}</td><td>${new Date(r.ts).toLocaleDateString()}</td><td><button class="badge" onclick="delRow('wallet',${i})">ุญุฐู</button></td></tr>`));}
  // Speakers
  const tbS=document.querySelector('#tblSpeakers tbody'); if(tbS){tbS.innerHTML='';state.speakers.forEach((r,i)=>tbS.insertAdjacentHTML('beforeend',`<tr><td>${r.name}</td><td>${r.field}</td><td>${r.org}</td><td>${r.status}</td><td><button class="badge" onclick="delRow('speakers',${i})">ุญุฐู</button></td></tr>`));}
  // Facilities
  const tbF=document.querySelector('#tblFacilities tbody'); if(tbF){tbF.innerHTML='';state.facilities.forEach((r,i)=>tbF.insertAdjacentHTML('beforeend',`<tr><td>${r.name}</td><td>${r.type}</td><td>${r.cap}</td><td>${r.loc}</td><td><button class="badge" onclick="delRow('facilities',${i})">ุญุฐู</button></td></tr>`));}
  // Coop
  const tbC=document.querySelector('#tblCoop tbody'); if(tbC){tbC.innerHTML='';state.coop.forEach((r,i)=>tbC.insertAdjacentHTML('beforeend',`<tr><td>${r.org}</td><td>${r.title}</td><td>${r.months}</td><td>${r.status}</td><td><button class="badge" onclick="delRow('coop',${i})">ุญุฐู</button></td></tr>`));}
}
function delRow(key,i){state[key].splice(i,1);db.save(state);fillTables();}

/* ุฅุฏุฑุงุฌ ุจูุงูุงุช */
function dbAdd(key){
  if(key==='projects'){
    const r={title:val('p_title'),sector:val('p_sector'),budget:+val('p_budget')||0,status:val('p_status'),desc:val('p_desc')};
    if(!r.title) return alert('ุฃุฏุฎู ุนููุงู ุงููุดุฑูุน'); state.projects.unshift(r);
  }
  if(key==='opps'){
    const r={type:val('o_type'),title:val('o_title'),org:val('o_org'),loc:val('o_loc')};
    if(!r.title) return alert('ุฃุฏุฎู ุนููุงู ุงููุฑุตุฉ'); state.opps.unshift(r);
  }
  if(key==='wallet'){
    const r={type:val('w_type'),amount:+val('w_amount')||0,ts:Date.now()}; state.wallet.unshift(r);
  }
  if(key==='speakers'){
    const r={name:val('s_name'),field:val('s_field'),org:val('s_org'),status:val('s_status')};
    if(!r.name) return alert('ุฃุฏุฎู ุงุณู ุงููุชุญุฏุซ'); state.speakers.unshift(r);
  }
  if(key==='facilities'){
    const r={name:val('f_name'),type:val('f_type'),cap:+val('f_cap')||0,loc:val('f_loc')};
    if(!r.name) return alert('ุฃุฏุฎู ุงุณู ุงูููุดุฃุฉ'); state.facilities.unshift(r);
  }
  if(key==='coop'){
    const r={org:val('c_org'),title:val('c_title'),months:+val('c_months')||0,status:val('c_status')};
    if(!r.title) return alert('ุฃุฏุฎู ุงููุณูู'); state.coop.unshift(r);
  }
  db.save(state); fillTables();
}
function val(id){return (document.getElementById(id)?.value||'').trim()}

/* ADMIN */
function renderUsers(){
  const tb=document.querySelector('#usersTbl tbody'); if(!tb) return; tb.innerHTML='';
  (state.users||[]).forEach((u,i)=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${u.name}</td><td>${u.role}</td><td>${u.account}</td><td><button class='badge' onclick='uDel(${i})'>ุญุฐู</button></td>`;tb.appendChild(tr);});
  // ุฃุฏูุงุฑ
  const out=document.getElementById('rolesOut'); if(out) out.textContent=JSON.stringify(state.roles,null,2);
}
function addUser(){
  const n=document.getElementById('uName').value.trim();
  const r=document.getElementById('uRole').value;
  const a=document.getElementById('uAccount').value;
  if(!n) return alert('ุงุฏุฎู ุงูุงุณู');
  state.users.unshift({name:n,role:r,account:a}); db.save(state); renderUsers();
}
function uDel(i){state.users.splice(i,1);db.save(state);renderUsers();}
function saveRole(){const role=document.getElementById('roleSel').value; const perms=document.getElementById('rolePerms').value.trim(); state.roles[role]=perms; db.save(state); document.getElementById('rolesOut').textContent=JSON.stringify(state.roles,null,2);}

/* ADMIN Section markup (reused from V3) */
</script>

<section id="admin" class="kit">
  <div class="container">
    <div class="grid grid-3">
      <div class="card">
        <h4>ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</h4>
        <div class="row">
          <div><label>ุงูุงุณู</label><input class="input" id="uName" placeholder="ุงุณู ุงููุณุชุฎุฏู"></div>
          <div><label>ุงูุฏูุฑ</label><select class="input" id="uRole"><option>Admin</option><option>Manager</option><option>Operator</option><option>Observer</option></select></div>
        </div>
        <div class="row">
          <div><label>ุงูุญุณุงุจ</label><select class="input" id="uAccount">
            <option>individual</option><option>private</option><option>nonprofit</option><option>universities</option>
            <option>government</option><option>donors</option><option>partners</option><option>dev_authorities</option>
          </select></div>
          <div style="display:flex;align-items:end"><button class="btn" onclick="addUser()">ุฅุถุงูุฉ</button></div>
        </div>
        <hr>
        <table class="table" id="usersTbl"><thead><tr><th>ุงูุงุณู</th><th>ุงูุฏูุฑ</th><th>ุงูุญุณุงุจ</th><th></th></tr></thead><tbody></tbody></table>
      </div>
      <div class="card">
        <h4>ุทุจูุงุช ุงูุตูุงุญูุงุช</h4>
        <p class="small">ุชุญุฑูุฑ ุงูุตูุงุญูุงุช ููู ุฏูุฑ (ุนุฑุถ ุชุฌุฑูุจู).</p>
        <div class="row">
          <div><label>ุงูุฏูุฑ</label><select class="input" id="roleSel"><option>Admin</option><option>Manager</option><option>Operator</option><option>Observer</option></select></div>
          <div><label>ุงูุตูุงุญูุงุช</label><input class="input" id="rolePerms" placeholder="ูุซุงู: ูุฑุงุกุฉุ ุฅูุดุงุกุ ุงุนุชูุงุฏุ ุชูุงูู"></div>
        </div>
        <div style="margin-top:8px"><button class="btn" onclick="saveRole()">ุญูุธ</button></div>
        <hr><pre id="rolesOut" class="small" style="white-space:pre-wrap"></pre>
      </div>
      <div class="card">
        <h4>ุชุตุฏูุฑ ุชูุฑูุฑ ูููุฉ ุญููููุฉ</h4>
        <p class="small">ูููู ููู ุงูุชูุงุฑูุฑ ูุงุญููุง ูู API ูุนููุฉ.</p>
        <button class="btn" onclick="exportValueReport()">ุชุตุฏูุฑ CSV</button>
        <div id="exportHint" class="small"></div>
      </div>
    </div>
  </div>
</section>

<script>
function exportValueReport(){
  const data=(govValues||[]).map(v=>`${v.name},${v.brief},${v.detail.replace(/\n/g,' ')}`);
  const csv="name,brief,detail\n"+data.join("\n");
  const blob=new Blob([csv],{type:'text/csv'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='Gov_Added_Value_Report.csv';a.click();
  const hint=document.getElementById('exportHint');if(hint)hint.textContent='ุชู ุฅูุดุงุก ุงูุชูุฑูุฑ (CSV).';
}

/* WORKFLOW */
const wfStages=['ุทูุจ','ุชุฏููู','ุงุนุชูุงุฏ ุฃููู','ุงุนุชูุงุฏ ููุงุฆู'];
function wfSave(){db.save(state);}
function wfRender(){const tb=document.querySelector('#wfTbl tbody'); if(!tb) return; tb.innerHTML=''; (state.wf||[]).forEach((it,i)=>{const next=wfStages[it.stage+1]||'โ';tb.insertAdjacentHTML('beforeend',`<tr><td>${it.title}</td><td>${(+it.amount).toLocaleString('en')}</td><td>${it.account}</td><td>${wfStages[it.stage]}</td><td>${it.stage<wfStages.length-1?`<button class="badge" onclick="wfNext(${i})">ูุฑุญูุฉ: ${next}</button>`:''} <button class="badge" onclick="wfDel(${i})">ุญุฐู</button></td></tr>`);});}
function wfCreate(){const t=val('wf_title');const a=+val('wf_amount')||0;const acc=val('wf_account');if(!t)return alert('ุฃุฏุฎู ุงูุนููุงู');state.wf.unshift({title:t,amount:a,account:acc,stage:0,ts:Date.now()});wfSave();wfRender();}
function wfNext(i){if(state.wf[i].stage<wfStages.length-1){state.wf[i].stage++;wfSave();wfRender();}}
function wfDel(i){state.wf.splice(i,1);wfSave();wfRender();}

/* SUPPORT */
const ticketsKey='tickets_v4';const tickets=JSON.parse(localStorage.getItem(ticketsKey)||'[]');
function renderTickets(){const tb=document.querySelector('#tickets tbody');if(!tb)return;tb.innerHTML='';tickets.forEach(t=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${t.t}</td><td>${t.p}</td><td>${t.s}</td>`;tb.appendChild(tr);});}
function addTicket(){tickets.push({t:document.getElementById('s1').value,p:document.getElementById('s2').value,s:'ููุชูุญุฉ'});localStorage.setItem(ticketsKey,JSON.stringify(tickets));renderTickets();}renderTickets();

/* DOCS */
const docsStatic=[{name:'ุงููุซููุฉ ุงูุฑุณููุฉ ุงูุฑุฆูุณูุฉ',file:'Hasseef_Official_Report_Main.pdf'},{name:'ุงูููู ุงููุงูููู ูุงูุงุณุชุฑุงุชูุฌู',file:'Legal_Strategic_File.pdf'},{name:'ูุซููุฉ ุงููุธุงู ุงูุชูููุฐู ูุงูุชููู',file:'Executive_Tech_System.pdf'}];
function renderDocs(){const el=document.getElementById('docsList');if(!el)return;el.innerHTML=docsStatic.map(d=>`<div class="card"><h4>${d.name}</h4><p class="small">${d.file.split('.').pop().toUpperCase()}</p><a class="btn" href="./docs/${d.file}" target="_blank">ุชุญููู</a></div>`).join('');}

/* Register (creates first Admin if needed) */
function doRegister(){
  const type=val('regType'); const name=(val('regName')||'Admin'); const email=val('regEmail'); const role=val('regRole'); const agree=document.getElementById('regAgree').checked;
  if(!agree)return alert('ุงูุฑุฌุงุก ุงูููุงููุฉ ุนูู ุงูุงุชูุงููุฉ'); state.users=state.users||[]; state.users.unshift({name,role,account:type,email}); db.save(state); localStorage.setItem('account',type); location.hash='#dashboard'; const msg=document.getElementById('regMsg');msg.classList.remove('hidden');msg.textContent='ุชู ุฅูุดุงุก ุงูุญุณุงุจ (ูุญูู).';
}

/* Charts + Map */
let mapChart;
const regions=[{id:'Hail',name:'ุญุงุฆู',jobs:72,grants:18,vols:220,dist:[12,18,22,10,8,20]},{id:'Riyadh',name:'ุงูุฑูุงุถ',jobs:310,grants:95,vols:920,dist:[20,28,34,12,10,26]},{id:'Makkah',name:'ููุฉ ุงูููุฑูุฉ',jobs:280,grants:88,vols:840,dist:[18,26,30,11,9,22]},{id:'Madinah',name:'ุงููุฏููุฉ ุงููููุฑุฉ',jobs:130,grants:42,vols:410,dist:[10,14,18,8,6,12]},{id:'Eastern',name:'ุงูุดุฑููุฉ',jobs:260,grants:74,vols:700,dist:[16,24,28,10,8,18]}];
function renderMap(){const sel=document.getElementById('regionSel');if(!sel)return;sel.innerHTML=regions.map(r=>`<option value="${r.id}">${r.name}</option>`).join('');sel.onchange=()=>updateRegion(sel.value);updateRegion(regions[0].id);}
function updateRegion(id){const r=regions.find(x=>x.id===id);if(!r)return;document.getElementById('kpiJobs').textContent=r.jobs;document.getElementById('kpiGrants').textContent=r.grants;document.getElementById('kpiVols').textContent=r.vols;if(typeof Chart==='undefined')return;const ctx=document.getElementById('mapChart');if(!ctx)return;if(mapChart)mapChart.destroy();mapChart=new Chart(ctx,{type:'bar',data:{labels:['ุงูุฃูุฑุงุฏ','ุงูุฎุงุต','ุบูุฑ ุงูุฑุจุญู','ุงูุฌุงูุนุงุช','ุงูุญูููุฉ','ุงููุงูุญูู'],datasets:[{label:'ุงููุฑุต',data:r.dist}]},options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}});}
function bindSvgMap(){const svg=document.querySelector('#ksaMap svg');if(svg && !svg.dataset.bound){svg.dataset.bound='1';svg.querySelectorAll('[data-region]').forEach(el=>{el.style.cursor='pointer';el.addEventListener('click',()=>updateRegion(el.getAttribute('data-region')));el.addEventListener('mouseenter',()=>el.setAttribute('fill','#e2e8f0'));el.addEventListener('mouseleave',()=>el.setAttribute('fill','#e5e7eb'));});}}

/* Utils */
document.addEventListener('DOMContentLoaded',()=>{ // seed ุฃููู ููุณุชุฎุฏู Admin ูู ุญุงู ุนุฏู ูุฌูุฏู
  if(!state.users?.length){state.users=[{name:'Admin',role:'Admin',account:'admin',email:'admin@example.com'}];db.save(state);}
});
function setActiveTabByName(n){document.querySelectorAll('#dashTabs .tab').forEach(t=>t.classList.toggle('active',t.textContent===n));}
function setVisible(selector, show){const el=document.querySelector(selector);if(el)el.classList.toggle('hidden',!show);}
function $(sel){return document.querySelector(sel);}
</script>
</body>
</html>
